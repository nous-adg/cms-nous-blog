import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l,R as h}from"./index.DB02PGg6.js";import{u as p,g}from"./useCategories.BE7b6g6E.js";function f(){const[t,r]=l.useState(()=>{if(typeof window>"u")return{search:"",categorie:"",date:"",status:""};const n=new URLSearchParams(window.location.search);return{search:n.get("search")||"",categorie:n.get("categorie")||"",date:n.get("date")||"",status:n.get("status")||""}}),o=(n,i)=>{r(c=>({...c,[n]:i}))},a=()=>{if(r({search:"",categorie:"",date:"",status:""}),typeof window<"u"){const i=window.location.pathname;window.history.pushState({},"",i)}},s=n=>{if(r(i=>({...i,[n]:""})),typeof window<"u"){const i=new URLSearchParams(window.location.search);i.delete(n);const c=`${window.location.pathname}?${i.toString()}`;window.history.pushState({},"",c)}};return l.useEffect(()=>{if(typeof window>"u")return;const n=new URLSearchParams;t.search&&n.set("search",t.search),t.categorie&&t.categorie!=="Todas"&&n.set("categorie",t.categorie),t.date&&n.set("date",t.date),t.status&&n.set("status",t.status);const i=`${window.location.pathname}?${n.toString()}`;window.history.pushState({},"",i)},[t]),{filters:t,updateFilter:o,clearFilters:a,removeFilter:s}}const b="https://blog-api-rrttqa.fly.dev/api/v1";function w(t){const[r,o]=l.useState([]),[a,s]=l.useState(!0),[n,i]=l.useState(null),c=l.useCallback(async()=>{s(!0),i(null);try{const d=new URLSearchParams({limit:"100",offset:"0"});t.search&&d.set("search",t.search),t.categorie&&t.categorie!=="Todas"&&d.set("categorie",t.categorie),t.date&&d.set("date",t.date),t.status&&d.set("status",t.status);const u=await fetch(`${b}/posts?${d.toString()}`);if(!u.ok)throw new Error(`Error: ${u.status}`);const x=await u.json();o(x.posts||[])}catch(d){i(d.message),o([])}finally{s(!1)}},[t.search,t.categorie,t.date,t.status]);return l.useEffect(()=>{c()},[c]),{posts:r,loading:a,error:n,refetch:c}}function j(t,r=500){const[o,a]=l.useState(t);return l.useEffect(()=>{const s=setTimeout(()=>{a(t)},r);return()=>{clearTimeout(s)}},[t,r]),o}function v({value:t,onChange:r}){const[o,a]=l.useState(t);return l.useEffect(()=>{a(t)},[t]),l.useEffect(()=>{const s=setTimeout(()=>{r("search",o)},500);return()=>clearTimeout(s)},[o]),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{className:"text-gray-400 font-semibold",htmlFor:"search",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{id:"search",type:"text",value:o,onChange:s=>a(s.target.value),className:"glass rounded-full pl-10 pr-4 py-2 border border-white/10 w-full focus:outline-none focus:ring-2 focus:ring-secondary-light text-gray-100",placeholder:"Por titulo, contenido, palabras clave"})]})]})})}function y({value:t,onChange:r}){const o=s=>{const n=s.target.value;if(n){const[i,c,d]=n.split("-"),u=new Date(Date.UTC(parseInt(i),parseInt(c)-1,parseInt(d))).toISOString();r("date",u)}else r("date","")},a=t?new Date(t).toISOString().split("T")[0]:"";return e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"date",className:"text-gray-400 font-semibold text-sm sm:text-base whitespace-nowrap",children:"Fecha"}),e.jsx("div",{className:"relative w-full",children:e.jsx("input",{type:"date",id:"date",value:a,onChange:o,className:"glass rounded-full px-4 py-1.5 sm:py-2 border border-white/10 w-full text-sm sm:text-base cursor-pointer focus:outline-none focus:ring-2 focus:ring-secondary-light text-center text-gray-100 [&::-webkit-calendar-picker-indicator]:cursor-pointer [&::-webkit-calendar-picker-indicator]:opacity-100 [&::-webkit-calendar-picker-indicator]:w-5 [&::-webkit-calendar-picker-indicator]:h-5 [&::-webkit-calendar-picker-indicator]:absolute [&::-webkit-calendar-picker-indicator]:right-3 [&::-webkit-calendar-picker-indicator]:top-1/2 [&::-webkit-calendar-picker-indicator]:-translate-y-1/2 [&::-webkit-calendar-picker-indicator]:bg-transparent [&::-webkit-calendar-picker-indicator]:filter [&::-webkit-calendar-picker-indicator]:brightness-0 [&::-webkit-calendar-picker-indicator]:saturate-100 [&::-webkit-calendar-picker-indicator]:invert-[0.7] [&::-webkit-calendar-picker-indicator]:sepia-0",style:{colorScheme:"dark"}})})]})}function N({value:t,onChange:r}){const{categories:o,loading:a}=p();return e.jsxs("div",{className:"flex flex-col gap-2 container mx-auto max-w-12xl",children:[e.jsx("label",{className:"font-semibold text-gray-400",htmlFor:"category-filter",children:"Categoría"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:`w-full glass border border-white/10 rounded-full py-2 px-4 font-alexandria appearance-none focus:outline-none focus:ring-2 focus:ring-secondary-light ${t&&t!=="Todas"?"text-secondary-light":"text-gray-400"}`,name:"category-filter",id:"category-filter",value:t||"Todas",onChange:s=>r("categorie",s.target.value),disabled:a,children:[e.jsx("option",{value:"Todas",children:"Todas"}),o.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsx("svg",{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}function k({value:t,onChange:r}){const o=t==="PUBLISHED",a=t==="DRAFT",s=!t||t==="",n=i=>{t===i?r("status",""):r("status",i)};return e.jsxs("div",{className:"flex flex-col w-fit gap-2",children:[e.jsx("label",{htmlFor:"status-switch",className:"font-semibold text-gray-400",children:"Publicado"}),e.jsxs("div",{className:`inline-flex items-center glass rounded-full p-1 relative border transition-colors ${s?"border-white/5 bg-transparent":"border-white/10"}`,children:[!s&&e.jsx("div",{className:"absolute top-1 left-1 bg-secondary-light rounded-full transition-transform duration-300 ease-in-out",style:{width:"calc(50% - 4px)",height:"calc(100% - 8px)",transform:o?"translateX(0)":"translateX(calc(100%))"}}),e.jsx("button",{type:"button",onClick:()=>n("PUBLISHED"),className:`px-6 py-1 rounded-full font-semibold transition-colors duration-300 ease-in-out z-10 relative ${o?"text-primary":s?"text-gray-400 cursor-pointer":"text-gray-500"}`,children:"Sí"}),e.jsx("button",{type:"button",onClick:()=>n("DRAFT"),className:`px-6 py-1 rounded-full font-semibold transition-colors duration-300 ease-in-out z-10 relative ${a?"text-primary":s?"text-gray-400 cursor-pointer":"text-gray-500"}`,children:"No"})]})]})}function S({filters:t,onRemove:r,onClearAll:o}){const a=[];if(t.search&&a.push({key:"search",label:"Búsqueda",value:t.search}),t.categorie&&t.categorie!=="Todas"&&a.push({key:"categorie",label:"Categoría",value:t.categorie}),t.date){const s=new Date(t.date).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",timeZone:"UTC"});a.push({key:"date",label:"Fecha desde",value:s})}if(t.status){const s=t.status==="PUBLISHED"?"Publicados":"Borradores";a.push({key:"status",label:"Estado",value:s})}return a.length===0?null:e.jsx("div",{className:"container mx-auto max-w-12xl px-4 sm:px-8 md:px-12 pb-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-[#515B54]",children:"Filtros activos:"}),a.map(s=>e.jsxs("div",{className:"inline-flex items-center gap-2 bg-secondary-light text-primary px-3 py-1 rounded-full text-sm",children:[e.jsxs("span",{className:"font-medium",children:[s.label,":"]}),e.jsx("span",{children:s.value}),e.jsx("button",{onClick:()=>r(s.key),className:" hover:text-primary hover:cursor-pointer rounded-full p-0.5 transition-colors","aria-label":`Eliminar filtro ${s.label}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},s.key)),e.jsx("button",{onClick:o,className:"text-sm text-red-600 hover:text-red-800 font-semibold underline cursor-pointer",children:"Limpiar todos"})]})})}const m=h.memo(({post:t})=>{const r=l.useMemo(()=>new Date(t.createdAt).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),[t.createdAt]),o=l.useMemo(()=>g(t.categorie),[t.categorie]);return e.jsxs("div",{className:"grid grid-cols-7 gap-4 p-4 hover:bg-gray-50/10 transition-colors min-w-[800px]",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"text-neutral-200 font-medium truncate",title:t.title,children:t.title})}),e.jsx("div",{children:e.jsx("p",{className:"text-neutral-200 text-sm",children:r})}),e.jsx("div",{children:e.jsx("p",{className:"text-neutral-200 text-sm bg-purple-400/10 border border-purple-400/60 px-2 py-1 rounded-full w-fit",children:o})}),e.jsx("div",{children:e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-semibold border ${t.status==="PUBLISHED"?"bg-green-500/10 text-green-500":"bg-gray-500/10 text-gray-500"}`,children:t.status==="PUBLISHED"?"Sí":"No"})}),e.jsx("div",{children:e.jsx("p",{className:"text-neutral-200 text-sm",children:t.views.toLocaleString()})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"text-blue-600/60 hover:text-neutral-200/60 text-sm font-medium cursor-pointer",onClick:()=>{localStorage.setItem("editPostId",t.id),localStorage.setItem("isLoadingPost","true"),window.location.href="/admin/crear-publicacion"},children:"Editar"}),e.jsx("button",{className:"text-red-600/60 hover:text-neutral-200/60 text-sm font-medium cursor-pointer",onClick:async()=>{if(confirm("¿Estás seguro de que quieres eliminar este post? Esta acción no se puede deshacer."))try{const a=await window.Clerk?.session?.getToken();if(!a){alert("No se pudo obtener el token de autenticación");return}if(!(await fetch(`https://blog-api-rrttqa.fly.dev/api/v1/posts/${t.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Error al eliminar el post");alert("Post eliminado exitosamente"),window.location.reload()}catch{alert("Error al eliminar el post")}},children:"Eliminar"})]})]})});m.displayName="PostItem";function L({posts:t,loading:r,error:o}){return r?e.jsx("div",{className:"border border-green-300/10 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"}),e.jsx("p",{className:"mt-4 font-semibold",children:"Cargando posts..."})]})}):o?e.jsx("div",{className:"border border-red-300/10 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-8 text-center text-red-600",children:[e.jsx("p",{className:"font-semibold",children:"Error al cargar los posts"}),e.jsx("p",{className:"text-sm mt-2",children:o})]})}):t.length===0?e.jsx("div",{className:"border border-gray-300/10 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"font-semibold text-lg",children:"No se encontraron posts"}),e.jsx("p",{className:"text-sm mt-2",children:"Intenta ajustar los filtros para ver más resultados"})]})}):e.jsxs("section",{className:"container mx-auto max-w-12xl py-4 px-4 sm:px-8 md:px-12",children:[e.jsx("div",{className:"mb-3 px-2",children:e.jsxs("p",{className:"text-sm text-[#515B54]",children:[e.jsx("span",{className:"font-semibold",children:t.length})," ",t.length===1?"resultado encontrado":"resultados encontrados"]})}),e.jsx("div",{className:"border border-gray-300/10 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"grid grid-cols-7 gap-4 p-4 min-w-[800px]",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Título"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Fecha"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Categoría"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Publicado"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Visitas"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Acciones"})})]}),t.map(a=>e.jsx(m,{post:a},a.id))]})})]})}function F(){const{filters:t,updateFilter:r,clearFilters:o,removeFilter:a}=f(),s=j(t.search,500),{posts:n,loading:i,error:c}=w({...t,search:s});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("section",{className:"container mx-auto max-w-12xl",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 py-4 px-4 sm:px-8 md:px-12",children:[e.jsx("div",{className:"col-span-1 sm:col-span-2 md:col-span-2 lg:col-span-3",children:e.jsx(v,{value:t.search,onChange:r})}),e.jsx("div",{className:"col-span-1 sm:col-span-1 md:col-span-1 lg:col-span-1",children:e.jsx(y,{value:t.date,onChange:r})}),e.jsx("div",{className:"col-span-1 sm:col-span-1 md:col-span-1 lg:col-span-1",children:e.jsx(N,{value:t.categorie,onChange:r})}),e.jsx("div",{className:"col-span-1 sm:col-span-2 md:col-span-4 lg:col-span-1",children:e.jsx(k,{value:t.status,onChange:r})})]})}),e.jsx(S,{filters:t,onRemove:a,onClearAll:o}),e.jsx("div",{className:"mx-4 pb-4",children:e.jsx(L,{posts:n,loading:i,error:c})})]})}export{F as PostsDashboard};
