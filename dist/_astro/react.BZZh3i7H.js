import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.DB02PGg6.js";import{u as m}from"./useCategories.B1-Y78JO.js";import{P as h}from"./PostItem.CBIGWHob.js";import"./categoryLabels.CBjB4mnr.js";function p(){const[t,a]=l.useState(()=>{if(typeof window>"u")return{search:"",categorie:"",date:"",status:""};const o=new URLSearchParams(window.location.search);return{search:o.get("search")||"",categorie:o.get("categorie")||"",date:o.get("date")||"",status:o.get("status")||""}}),n=(o,i)=>{a(c=>({...c,[o]:i}))},r=()=>{if(a({search:"",categorie:"",date:"",status:""}),typeof window<"u"){const i=window.location.pathname;window.history.pushState({},"",i)}},s=o=>{if(a(i=>({...i,[o]:""})),typeof window<"u"){const i=new URLSearchParams(window.location.search);i.delete(o);const c=`${window.location.pathname}?${i.toString()}`;window.history.pushState({},"",c)}};return l.useEffect(()=>{if(typeof window>"u")return;const o=new URLSearchParams;t.search&&o.set("search",t.search),t.categorie&&t.categorie!=="Todas"&&o.set("categorie",t.categorie),t.date&&o.set("date",t.date),t.status&&o.set("status",t.status);const i=`${window.location.pathname}?${o.toString()}`;window.history.pushState({},"",i)},[t]),{filters:t,updateFilter:n,clearFilters:r,removeFilter:s}}const g="https://blog-api-rrttqa.fly.dev/api/v1";function f(t){const[a,n]=l.useState([]),[r,s]=l.useState(!0),[o,i]=l.useState(null),c=l.useCallback(async()=>{s(!0),i(null);try{const d=new URLSearchParams({limit:"100",offset:"0"});t.search&&d.set("search",t.search),t.categorie&&t.categorie!=="Todas"&&d.set("categorie",t.categorie),t.date&&d.set("date",t.date),t.status&&d.set("status",t.status);const u=await fetch(`${g}/posts?${d.toString()}`);if(!u.ok)throw new Error(`Error: ${u.status}`);const x=await u.json();n(x.posts||[])}catch(d){i(d.message),n([])}finally{s(!1)}},[t.search,t.categorie,t.date,t.status]);return l.useEffect(()=>{c()},[c]),{posts:a,loading:r,error:o,refetch:c}}function b(t,a=500){const[n,r]=l.useState(t);return l.useEffect(()=>{const s=setTimeout(()=>{r(t)},a);return()=>{clearTimeout(s)}},[t,a]),n}function w({value:t,onChange:a}){const[n,r]=l.useState(t);return l.useEffect(()=>{r(t)},[t]),l.useEffect(()=>{const s=setTimeout(()=>{a("search",n)},500);return()=>clearTimeout(s)},[n]),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{className:"text-gray-400 font-semibold",htmlFor:"search",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{id:"search",type:"text",value:n,onChange:s=>r(s.target.value),className:"glass rounded-full pl-10 pr-4 py-2 border border-white/10 w-full focus:outline-none focus:ring-2 focus:ring-secondary-light text-gray-100",placeholder:"Por titulo, contenido, palabras clave"})]})]})})}function j({value:t,onChange:a}){const n=s=>{const o=s.target.value;if(o){const[i,c,d]=o.split("-"),u=new Date(Date.UTC(parseInt(i),parseInt(c)-1,parseInt(d))).toISOString();a("date",u)}else a("date","")},r=t?new Date(t).toISOString().split("T")[0]:"";return e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"date",className:"text-gray-400 font-semibold text-sm sm:text-base whitespace-nowrap",children:"Fecha"}),e.jsx("div",{className:"relative w-full",children:e.jsx("input",{type:"date",id:"date",value:r,onChange:n,className:"glass rounded-full px-4 py-1.5 sm:py-2 border border-white/10 w-full text-sm sm:text-base cursor-pointer focus:outline-none focus:ring-2 focus:ring-secondary-light text-center text-gray-100 [&::-webkit-calendar-picker-indicator]:cursor-pointer [&::-webkit-calendar-picker-indicator]:opacity-100 [&::-webkit-calendar-picker-indicator]:w-5 [&::-webkit-calendar-picker-indicator]:h-5 [&::-webkit-calendar-picker-indicator]:absolute [&::-webkit-calendar-picker-indicator]:right-3 [&::-webkit-calendar-picker-indicator]:top-1/2 [&::-webkit-calendar-picker-indicator]:-translate-y-1/2 [&::-webkit-calendar-picker-indicator]:bg-transparent [&::-webkit-calendar-picker-indicator]:filter [&::-webkit-calendar-picker-indicator]:brightness-0 [&::-webkit-calendar-picker-indicator]:saturate-100 [&::-webkit-calendar-picker-indicator]:invert-[0.7] [&::-webkit-calendar-picker-indicator]:sepia-0",style:{colorScheme:"dark"}})})]})}function v({value:t,onChange:a}){const{categories:n,loading:r}=m();return e.jsxs("div",{className:"flex flex-col gap-2 container mx-auto max-w-12xl",children:[e.jsx("label",{className:"font-semibold text-gray-400",htmlFor:"category-filter",children:"Categoría"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:`w-full glass border border-white/10 rounded-full py-2 px-4 font-alexandria appearance-none focus:outline-none focus:ring-2 focus:ring-secondary-light ${t&&t!=="Todas"?"text-secondary-light":"text-gray-400"}`,name:"category-filter",id:"category-filter",value:t||"Todas",onChange:s=>a("categorie",s.target.value),disabled:r,children:[e.jsx("option",{value:"Todas",children:"Todas"}),n.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsx("svg",{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}function y({value:t,onChange:a}){const n=t==="PUBLISHED",r=t==="DRAFT",s=!t||t==="",o=i=>{t===i?a("status",""):a("status",i)};return e.jsxs("div",{className:"flex flex-col w-fit gap-2",children:[e.jsx("label",{htmlFor:"status-switch",className:"font-semibold text-gray-400",children:"Publicado"}),e.jsxs("div",{className:`inline-flex items-center glass rounded-full p-1 relative border transition-colors ${s?"border-white/5 bg-transparent":"border-white/10"}`,children:[!s&&e.jsx("div",{className:"absolute top-1 left-1 bg-secondary-light rounded-full transition-transform duration-300 ease-in-out",style:{width:"calc(50% - 4px)",height:"calc(100% - 8px)",transform:n?"translateX(0)":"translateX(calc(100%))"}}),e.jsx("button",{type:"button",onClick:()=>o("PUBLISHED"),className:`px-6 py-1 rounded-full font-semibold transition-colors duration-300 ease-in-out z-10 relative ${n?"text-primary":s?"text-gray-400 cursor-pointer":"text-gray-500"}`,children:"Sí"}),e.jsx("button",{type:"button",onClick:()=>o("DRAFT"),className:`px-6 py-1 rounded-full font-semibold transition-colors duration-300 ease-in-out z-10 relative ${r?"text-primary":s?"text-gray-400 cursor-pointer":"text-gray-500"}`,children:"No"})]})]})}function N({filters:t,onRemove:a,onClearAll:n}){const r=[];if(t.search&&r.push({key:"search",label:"Búsqueda",value:t.search}),t.categorie&&t.categorie!=="Todas"&&r.push({key:"categorie",label:"Categoría",value:t.categorie}),t.date){const s=new Date(t.date).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",timeZone:"UTC"});r.push({key:"date",label:"Fecha desde",value:s})}if(t.status){const s=t.status==="PUBLISHED"?"Publicados":"Borradores";r.push({key:"status",label:"Estado",value:s})}return r.length===0?null:e.jsx("div",{className:"container mx-auto max-w-12xl px-4 sm:px-8 md:px-12 pb-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-[#515B54]",children:"Filtros activos:"}),r.map(s=>e.jsxs("div",{className:"inline-flex items-center gap-2 bg-secondary-light text-primary px-3 py-1 rounded-full text-sm",children:[e.jsxs("span",{className:"font-medium",children:[s.label,":"]}),e.jsx("span",{children:s.value}),e.jsx("button",{onClick:()=>a(s.key),className:" hover:text-primary hover:cursor-pointer rounded-full p-0.5 transition-colors","aria-label":`Eliminar filtro ${s.label}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},s.key)),e.jsx("button",{onClick:n,className:"text-sm text-red-600 hover:text-red-800 font-semibold underline cursor-pointer",children:"Limpiar todos"})]})})}function k({posts:t,loading:a,error:n}){return a?e.jsx("div",{className:"border border-green-300/10 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-secondary"}),e.jsx("p",{className:"mt-4 font-semibold",children:"Cargando posts..."})]})}):n?e.jsx("div",{className:"border border-red-300/10 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-8 text-center text-red-600",children:[e.jsx("p",{className:"font-semibold",children:"Error al cargar los posts"}),e.jsx("p",{className:"text-sm mt-2",children:n})]})}):t.length===0?e.jsx("div",{className:"border border-gray-300/10 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"font-semibold text-lg",children:"No se encontraron posts"}),e.jsx("p",{className:"text-sm mt-2",children:"Intenta ajustar los filtros para ver más resultados"})]})}):e.jsxs("section",{className:"container mx-auto max-w-12xl py-4 px-4 sm:px-8 md:px-12",children:[e.jsx("div",{className:"mb-3 px-2",children:e.jsxs("p",{className:"text-sm text-[#515B54]",children:[e.jsx("span",{className:"font-semibold",children:t.length})," ",t.length===1?"resultado encontrado":"resultados encontrados"]})}),e.jsx("div",{className:"border border-gray-300/10 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"grid grid-cols-7 gap-4 p-4 min-w-[800px]",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Título"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Fecha"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Categoría"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Publicado"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Visitas"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-[#515B54]",children:"Acciones"})})]}),t.map(r=>e.jsx(h,{post:r},r.id))]})})]})}function B(){const{filters:t,updateFilter:a,clearFilters:n,removeFilter:r}=p(),s=b(t.search,500),{posts:o,loading:i,error:c}=f({...t,search:s});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("section",{className:"container mx-auto max-w-12xl",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 py-4 px-4 sm:px-8 md:px-12",children:[e.jsx("div",{className:"col-span-1 sm:col-span-2 md:col-span-2 lg:col-span-3",children:e.jsx(w,{value:t.search,onChange:a})}),e.jsx("div",{className:"col-span-1 sm:col-span-1 md:col-span-1 lg:col-span-1",children:e.jsx(j,{value:t.date,onChange:a})}),e.jsx("div",{className:"col-span-1 sm:col-span-1 md:col-span-1 lg:col-span-1",children:e.jsx(v,{value:t.categorie,onChange:a})}),e.jsx("div",{className:"col-span-1 sm:col-span-2 md:col-span-4 lg:col-span-1",children:e.jsx(y,{value:t.status,onChange:a})})]})}),e.jsx(N,{filters:t,onRemove:r,onClearAll:n}),e.jsx("div",{className:"mx-4 pb-4",children:e.jsx(k,{posts:o,loading:i,error:c})})]})}export{B as PostsDashboard};
