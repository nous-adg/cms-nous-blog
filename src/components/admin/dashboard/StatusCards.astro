---
const API_URL =
    import.meta.env.PUBLIC_API_URL || "http://localhost:3000/api/v1";

// Función para obtener estadísticas de posts
async function fetchPostStats() {
    try {
        // Obtener posts publicados
        const publishedResponse = await fetch(
            `${API_URL}/posts?status=PUBLISHED`,
        );
        const publishedData = await publishedResponse.json();
        const publishedCount = publishedData.total || 0;

        // Obtener posts en borrador
        const draftResponse = await fetch(`${API_URL}/posts?status=DRAFT`);
        const draftData = await draftResponse.json();
        const draftCount = draftData.total || 0;

        return {
            published: publishedCount,
            draft: draftCount,
        };
    } catch (error) {
        console.error("Error fetching post stats:", error);
        return {
            published: 0,
            draft: 0,
        };
    }
}

// Función para obtener total de vistas
async function fetchTotalViews() {
    try {
        const response = await fetch(`${API_URL}/posts/stats/views`);
        if (!response.ok) {
            // Si el endpoint no existe, retornar 0
            return 0;
        }
        const data = await response.json();
        return data.totalViews || 0;
    } catch (error) {
        console.error("Error fetching total views:", error);
        return 0;
    }
}

// Obtener estadísticas
const postStats = await fetchPostStats();
const totalViews = await fetchTotalViews();
---

<section class="container mx-auto max-w-12xl mt-10">
    <div
        class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"
    >
        <article
            class="flex flex-col gap-2 rounded-lg glass p-4 border border-white/5"
        >
            <h3 class="font-semibold text-gray-400">Cantidad de vistas</h3>
            <p class="text-3xl font-bold text-[var(--color-secondary)]">
                {totalViews.toLocaleString()}
            </p>
        </article>
        <article
            class="flex flex-col gap-2 rounded-lg glass p-4 border border-white/5"
        >
            <h3 class="font-semibold text-gray-400">
                Cantidad de suscriptores
            </h3>
            <p class="text-3xl font-bold text-[var(--color-secondary)]">32</p>
        </article>
        <article
            class="flex flex-col gap-2 rounded-lg glass p-4 border border-white/5"
        >
            <h3 class="font-semibold text-gray-400">Posts publicados</h3>
            <p class="text-3xl font-bold text-[var(--color-secondary)]">
                {postStats.published}
            </p>
        </article>
        <article
            class="flex flex-col gap-2 rounded-lg glass p-4 border border-white/5"
        >
            <h3 class="font-semibold text-gray-400">Posts en borrador</h3>
            <p class="text-3xl font-bold text-[var(--color-secondary)]">
                {postStats.draft}
            </p>
        </article>
    </div>
</section>
